@using OCMS.Common.CustomClasses
@{
    ViewBag.Title = "Complaints";
    Layout = "~/Areas/Admin/Views/Shared/_OcmsAdminLayout.cshtml";
}


<div class="container-fluid">
    <!-- Page Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="fw-bold mb-0" id="ComplaintTitle">Complaints</h2>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb mb-0 small">
                    <li class="breadcrumb-item"><a href="/Admin/AdminHome/AdminIndex">Dashboard</a></li>
                    <li class="breadcrumb-item"><a href="#">Users</a></li>
                    <li class="breadcrumb-item active">Data Table</li>
                </ol>
            </nav>
        </div>
    </div>

    <!-- Users Table -->
    <div class="card shadow-sm">
        <div class="card-body">
            <div id="loadcomplaints">
                <!-- Ajax-loaded users table -->
            </div>
        </div>
    </div>
</div>


@section Loadfiles {
    <script>
        $(document).ready(function () {
            // Load users when page first opens
            LoadComplaintPage('@(TempData["RequestType"] ?? "AllComplaints")');
        });

        function LoadComplaintPage(requestType) {
            $.ajax({
                type: 'GET',
                url: "/Admin/ComplaintManagment/GetAllComplaints",
                data: { RequestType: requestType },
                success: function (result) {
                    $('#loadcomplaints').html(result);
                    $('#datatable').DataTable();
                }
            });
        }


        function UpdateStatus(complaintid, status) {
            swal({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                type: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Yes, Update Status!',
                cancelButtonText: 'No, cancel!',
                confirmButtonClass: 'btn btn-success',
                cancelButtonClass: 'btn btn-danger m-l-10',
                buttonsStyling: false
            }).then(function () {
                debugger;
                $.ajax({
                    type: "POST",
                    url: "/Admin/ComplaintManagment/UpdateComplaintStatus",
                    data: { complaintid: complaintid, StatusCode: status },
                    success: function (result) {
                        if (result == 1) {
                            swal('Updated!', 'Complaint status changed successfully.', 'success');
                        }
                    }
                });
            }, function (dismiss) {
                if (dismiss === 'cancel') {
                    swal('Cancelled', 'No changes were made.', 'error');
                }
            });
   }

        function Delete(complaintid) {
            swal({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                type: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Yes, Delete User!',
                cancelButtonText: 'No, cancel!',
                confirmButtonClass: 'btn btn-success',
                cancelButtonClass: 'btn btn-danger m-l-10',
                buttonsStyling: false
            }).then(function () {
                debugger;
                $.ajax({
                    type: "POST",
                    url: "/Admin/ComplaintManagment/RemoveComplaint",
                    data: { complaintid: complaintid },
                    success: function (result) {
                        debugger;
                        if (result == @((int)OperationStatus.Success)) {
                            swal('Deleted!', 'Complaint removed successfully.', 'success');
                        }
                        else {
                            swal('Failed!', 'Operation failed.', 'error');
                        }
                    }
                });
            }, function (dismiss) {
                if (dismiss === 'cancel') {
                    swal('Cancelled', 'Complaint is safe :)', 'error');
                }
            });
   }
    </script>
}

